<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>M3U8 Player</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
html, body {
    margin:0;
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
}
#video {
    width:100%;
    height:100%;
    object-fit:contain;
    background:#000;
}

/* 控件容器放在视频上 */
#controls {
    position:absolute;
    bottom:20px;
    left:20px;
    right:20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    pointer-events:none; /* 除了控件本身，其他区域点击不生效 */
}

/* 进度条 */
#progress-container {
    flex:1;
    height:5px;
    background:rgba(255,255,255,0.2);
    border-radius:2px;
    margin-right:10px;
    cursor:pointer;
    pointer-events:auto;
}
#progress-bar {
    width:0%;
    height:100%;
    background:#0e90d2;
    border-radius:2px;
    transition:width 0.1s;
}

/* 音量竖条 */
#volume-container {
    width:30px;
    height:100px;
    display:flex;
    align-items:flex-end;
    cursor:pointer;
    pointer-events:auto;
    position:relative;
    background:rgba(0,0,0,0.2);
    border-radius:4px;
}
#volume-bg {
    position:absolute;
    width:100%;
    height:100%;
    background:rgba(255,255,255,0.2);
    border-radius:4px;
}
#volume-bar {
    width:100%;
    height:0%;
    background:#0e90d2;
    border-radius:4px 4px 0 0;
    transition: height 0.1s;
}

/* 提示 */
.tip{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-size:20px;
    text-align:center;
}
</style>
</head>
<body>

<video id="video" autoplay muted playsinline webkit-playsinline></video>

<div id="controls">
    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>
    <div id="volume-container">
        <div id="volume-bg"></div>
        <div id="volume-bar"></div>
    </div>
</div>

<div id="tip" class="tip" style="display:none"></div>

<script>
const url = new URLSearchParams(location.search).get('url');
const video = document.getElementById('video');
const tip = document.getElementById('tip');
const volumeContainer = document.getElementById('volume-container');
const volumeBar = document.getElementById('volume-bar');
const progressContainer = document.getElementById('progress-container');
const progressBar = document.getElementById('progress-bar');

if(!url){
    tip.style.display = 'flex';
    tip.innerHTML = `使用方法：<br>域名后加 ?url=你的m3u8<br><br>例如：<br>https://你的域名/?url=https://example.com/xxx.m3u8`;
} else {
    tip.style.display = 'none';

    // Hls.js 初始化
    if(Hls.isSupported()){
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
    } else if(video.canPlayType('application/vnd.apple.mpegurl')){
        video.src = url;
    }

    video.volume = 0.1; 
    video.muted = true;  

    // 音量条操作
    function setVolumeByMouse(e){
        const rect = volumeContainer.getBoundingClientRect();
        let vol = (rect.bottom - e.clientY)/rect.height;
        vol = Math.max(0, Math.min(1, vol));
        volumeBar.style.height = (vol*100)+'%';
        video.volume = vol;
        video.muted = false; // 用户操作解除静音
    }
    volumeContainer.addEventListener('mousedown', e => {
        setVolumeByMouse(e);
        const moveHandler = ev => setVolumeByMouse(ev);
        document.addEventListener('mousemove', moveHandler);
        document.addEventListener('mouseup', ()=> document.removeEventListener('mousemove', moveHandler), {once:true});
    });
    volumeBar.style.height = (video.volume*100)+'%';

    // 进度条
    function updateProgress(){
        if(video.duration){
            const percent = (video.currentTime/video.duration)*100;
            progressBar.style.width = percent+'%';
        }
        requestAnimationFrame(updateProgress);
    }
    updateProgress();

    // 点击进度条跳转
    progressContainer.addEventListener('click', e=>{
        const rect = progressContainer.getBoundingClientRect();
        const percent = (e.clientX - rect.left)/rect.width;
        video.currentTime = video.duration * percent;
    });
}
</script>

</body>
</html>
