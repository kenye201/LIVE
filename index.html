<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M3U8 在线播放器</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
html, body {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
}
video {
    width:100%;
    height:100%;
    object-fit:contain;
}

/* 音量控件悬浮在右下角 */
#volume-container {
    position: absolute;
    bottom: 30px;
    right: 30px;
    width: 40px;       /* 加粗 */
    height: 120px;
    background: rgba(0,0,0,0.3);
    border-radius: 6px;
    display: flex;
    align-items: flex-end;
    cursor: pointer;
    z-index: 10;
}
#volume-bg {
    position:absolute;
    width:100%;
    height:100%;
    background: rgba(255,255,255,0.2);
    border-radius: 6px;
}
#volume-bar {
    width:100%;
    height:0%;
    background:#0e90d2;
    border-radius: 6px 6px 0 0;
    transition: height 0.1s;
}

.tip {
    color: #fff;
    font-size: 24px;
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.6);
    padding: 20px 40px;
    border-radius: 10px;
}
</style>
</head>
<body>
<video id="video" controls autoplay muted playsinline webkit-playsinline></video>

<div id="volume-container">
    <div id="volume-bg"></div>
    <div id="volume-bar"></div>
</div>

<script>
const urlParam = new URLSearchParams(location.search).get('url');
const video = document.getElementById('video');
const volumeContainer = document.getElementById('volume-container');
const volumeBar = document.getElementById('volume-bar');

if(!urlParam){
    document.body.innerHTML = '<div class="tip">使用方法：<br>在域名后添加 ?url=你的m3u8地址<br><br>例如：<br>https://yourdomain.com/?url=https://example.com/stream.m3u8</div>';
} else {
    if(Hls.isSupported()){
        const hls = new Hls();
        hls.loadSource(urlParam);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
    } else if(video.canPlayType('application/vnd.apple.mpegurl')){
        video.src = urlParam;
        video.addEventListener('loadedmetadata', () => video.play());
    } else {
        document.body.innerHTML = '<div class="tip">您的浏览器不支持 HLS 播放</div>';
    }

    video.volume = 0.1;   // 初始音量
    video.muted = true;   // 静音

    // 音量拖动控制
    function setVolume(e){
        const rect = volumeContainer.getBoundingClientRect();
        let vol = (rect.bottom - e.clientY)/rect.height;
        vol = Math.max(0, Math.min(1, vol));
        volumeBar.style.height = (vol*100)+'%';
        video.volume = vol;
        video.muted = false; // 用户操作解除静音
    }

    volumeContainer.addEventListener('mousedown', e=>{
        setVolume(e);
        const moveHandler = ev => setVolume(ev);
        document.addEventListener('mousemove', moveHandler);
        document.addEventListener('mouseup', ()=> document.removeEventListener('mousemove', moveHandler), {once:true});
    });

    // 初始化音量条高度
    volumeBar.style.height = (video.volume*100)+'%';
}
</script>
</body>
</html>
